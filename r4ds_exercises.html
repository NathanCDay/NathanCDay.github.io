<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>R4DS Exercises</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />
<link rel="shortcut icon" type="image/png" href="www/favicon2.png">

<link rel="stylesheet" type="text/css"
          href="https://fonts.googleapis.com/css?family=Tangerine">
          
<link rel="stylesheet" type="text/css"
          href="https://fonts.googleapis.com/css?family=Atomic+Age|Roboto">
          
<style>
    .navbar {
        font-family: 'Atomic Age';
    }
    .tocify {
        font-family: 'Atomic Age';
    }
    h1 {
        font-family: 'Atomic Age';
    }
    p {
        font-family: 'Roboto';
    }

</style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #2a211c; color: #bdae9d; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; background-color: #2a211c; color: #bdae9d; border-right: 1px solid #bdae9d; }
td.sourceCode { padding-left: 5px; }
pre, code { color: #bdae9d; background-color: #2a211c; }
code > span.kw { color: #43a8ed; font-weight: bold; } /* Keyword */
code > span.dt { text-decoration: underline; } /* DataType */
code > span.dv { color: #44aa43; } /* DecVal */
code > span.bn { color: #44aa43; } /* BaseN */
code > span.fl { color: #44aa43; } /* Float */
code > span.ch { color: #049b0a; } /* Char */
code > span.st { color: #049b0a; } /* String */
code > span.co { color: #0066ff; font-style: italic; } /* Comment */
code > span.al { color: #ffff00; } /* Alert */
code > span.fu { color: #ff9358; font-weight: bold; } /* Function */
code > span.er { color: #ffff00; font-weight: bold; } /* Error */
code > span.wa { color: #ffff00; font-weight: bold; } /* Warning */
code > span.cn { } /* Constant */
code > span.sc { color: #049b0a; } /* SpecialChar */
code > span.vs { color: #049b0a; } /* VerbatimString */
code > span.ss { color: #049b0a; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { color: #43a8ed; font-weight: bold; } /* ControlFlow */
code > span.op { } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { font-weight: bold; } /* Preprocessor */
code > span.at { } /* Attribute */
code > span.do { color: #0066ff; font-style: italic; } /* Documentation */
code > span.an { color: #0066ff; font-weight: bold; font-style: italic; } /* Annotation */
code > span.co { color: #0066ff; font-weight: bold; font-style: italic; } /* Comment */
code > span.in { color: #0066ff; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Nate Day</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="about.html">
    <span class="fa fa-user"></span>
     
    About
  </a>
</li>
<li>
  <a href="r4ds_exercises.html">
    <span class="fa fa-pencil"></span>
     
    R4DS
  </a>
</li>
<li>
  <a href="sports_senti.html">
    <span class="fa fa-futbol-o"></span>
     
    Sports Sentiment
  </a>
</li>
<li>
  <a href="shiny.html">
    <span class="fa fa-flask"></span>
     
    Shiny
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-bar-chart"></span>
     
    Data Docs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="state_park_viz.html">
        <span class="fa fa-globe"></span>
         
        State Park Popularity
      </a>
    </li>
    <li>
      <a href="Cats_with_Pipes.html">
        <span class="fa fa-puzzle-piece"></span>
         
        Piping with Purrr
      </a>
    </li>
    <li>
      <a href="dc_crime.html">
        <span class="fa fa-gavel"></span>
         
        DC Crime Report
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-wrench"></span>
     
    Tech Docs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="cloudflare.html">
        <span class="fa fa-cloud"></span>
         
        HTTPS via CloudFlare
      </a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://www.linkedin.com/in/nathan-day-59b48435/">
    <span class="fa fa-linkedin-square fa-2x"></span>
     
  </a>
</li>
<li>
  <a href="https://stackoverflow.com/users/5878751/nate-day?tab=responses">
    <span class="fa fa-stack-overflow fa-2x"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/NathanCDay?tab=stars">
    <span class="fa fa-github fa-2x"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">R4DS Exercises</h1>

</div>


<div id="overview" class="section level1">
<h1>Overview</h1>
<p>I’m guiding a group walkthrough of Garrett Grolemund and Hadley Wickam’s great book <a href="http://r4ds.had.co.nz/">R for Data Science</a>. We are trying to cover a chapter of material per week and have a one-hour weekly code review to sit together and discuss the Excersises. If you live around Charlottesville and are interested in joining, ping me.</p>
<p>These are the answers to the excercises we have covered so far and will update after our mostly weekly meetings.</p>
</div>
<div id="intro-to-ggplot2" class="section level1">
<h1>3 Intro to <code>ggplot2</code></h1>
<div id="first-steps" class="section level3">
<h3>3.2 First Steps</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(magrittr) <span class="co"># %&lt;&gt;%</span>
<span class="kw">library</span>(tidyverse)</code></pre></div>
<ol style="list-style-type: decimal">
<li>Run ggplot(data = mpg). What do you see?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg) <span class="co"># grey square</span></code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/3.2.4.1-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># this is the initialized plotting area</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>How many rows are in mpg? How many columns?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(mpg)</code></pre></div>
<pre><code>## [1] 234  11</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>What does the drv variable describe? Read the help for ?mpg to find out.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?mpg </code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Make a scatterplot of hwy vs cyl.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> hwy, <span class="dt">y =</span> cyl))</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/3.2.4.4-1.png" width="672" /></p>
<ol start="5" style="list-style-type: decimal">
<li>What happens if you make a scatterplot of class vs drv? Why is the plot not useful?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> class, <span class="dt">y =</span> drv))<span class="co"># factor vs factor points</span></code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/3.2.4.5-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># need some sort of density/count viz instead</span></code></pre></div>
</div>
<div id="aesthetics" class="section level3">
<h3>3.3 Aesthetics</h3>
<ol style="list-style-type: decimal">
<li>What’s gone wrong with this code? Why are the points not blue?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>))</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/3.3.1.1-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># aes is for mapping columns in mpg by name</span>
<span class="co"># doesn&#39;t understand color names inside aes() so uses default color scale</span>

<span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>)</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/3.3.1.1-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># just move it outside</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Which variables in mpg are categorical? Which variables are continuous? (Hint: type ?mpg to read the documentation for the dataset). How can you see this information when you run mpg?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(mpg) <span class="co"># chr/fct is categorical, int/num is numeric</span></code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    234 obs. of  11 variables:
##  $ manufacturer: chr  &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; ...
##  $ model       : chr  &quot;a4&quot; &quot;a4&quot; &quot;a4&quot; &quot;a4&quot; ...
##  $ displ       : num  1.8 1.8 2 2 2.8 2.8 3.1 1.8 1.8 2 ...
##  $ year        : int  1999 1999 2008 2008 1999 1999 2008 1999 1999 2008 ...
##  $ cyl         : int  4 4 4 4 6 6 6 4 4 4 ...
##  $ trans       : chr  &quot;auto(l5)&quot; &quot;manual(m5)&quot; &quot;manual(m6)&quot; &quot;auto(av)&quot; ...
##  $ drv         : chr  &quot;f&quot; &quot;f&quot; &quot;f&quot; &quot;f&quot; ...
##  $ cty         : int  18 21 20 21 16 18 18 18 16 20 ...
##  $ hwy         : int  29 29 31 30 26 26 27 26 25 28 ...
##  $ fl          : chr  &quot;p&quot; &quot;p&quot; &quot;p&quot; &quot;p&quot; ...
##  $ class       : chr  &quot;compact&quot; &quot;compact&quot; &quot;compact&quot; &quot;compact&quot; ...</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Map a continuous variable to color, size, and shape. How do these aesthetics behave differently for categorical vs. continuous variables?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, cty, <span class="dt">color =</span> hwy)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="co"># continuous graident</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Color&quot;</span>)</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/3.3.1.3-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, cty, <span class="dt">size =</span> hwy)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="co"># continuous gradient</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Size&quot;</span>)</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/3.3.1.3-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Error: A continuous variable can not be mapped to shape</span>
<span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, cty, <span class="dt">shape =</span> hwy)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="co"># can&#39;t map continuous to shape</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Shape&quot;</span>)</code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>What happens if you map the same variable to multiple aesthetics?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, cty, <span class="dt">fill =</span> trans)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">size =</span> <span class="dv">4</span>)</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/3.3.1.4-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># you waste resolution</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>What does the stroke aesthetic do? What shapes does it work with? (Hint: use ?geom_point)</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, cty, <span class="dt">fill =</span> trans)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">stroke =</span> <span class="dv">2</span>, <span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">size =</span> <span class="dv">4</span>)</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/3.3.1.5-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># stroke is the outline thickness of shapes 21:25</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>What happens if you map an aesthetic to something other than a variable name, like aes(colour = displ &lt; 5)?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(drv)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span>hwy) <span class="co"># bins it</span></code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/3.3.1.6-1.png" width="672" /></p>
</div>
<div id="facetting" class="section level3">
<h3>3.5 Facetting</h3>
<ol style="list-style-type: decimal">
<li>What happens if you facet on a continuous variable?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(drv)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span>hwy) <span class="co"># coherces to intervals</span></code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/3.5.1.1-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>What do the empty cells in plot with facet_grid(drv ~ cyl) mean? How do they relate to this plot?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> drv, <span class="dt">y =</span> cyl)) <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>(drv <span class="op">~</span><span class="st"> </span>cyl) <span class="co"># combinations do not exist</span></code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/3.5.1.2-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># facet_wrap() will drop them </span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>What plots does the following code make? What does . do?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_grid</span>(drv <span class="op">~</span><span class="st"> </span>.) <span class="co"># compares against nothing if var is first (facets on y)</span></code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/3.5.1.3-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_grid</span>(<span class="op">~</span><span class="st"> </span>cyl) <span class="co"># don&#39;t need a dot if var is second (facets on x)</span></code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/3.5.1.3-2.png" width="672" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Take the first faceted plot in this section: What are the advantages to using faceting instead of the colour aesthetic? What are the disadvantages? How might the balance change if you had a larger dataset?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>class, <span class="dt">nrow =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/3.5.1.4-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(diamonds) <span class="co"># a larger dataset</span></code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    53940 obs. of  10 variables:
##  $ carat  : num  0.23 0.21 0.23 0.29 0.31 0.24 0.24 0.26 0.22 0.23 ...
##  $ cut    : Ord.factor w/ 5 levels &quot;Fair&quot;&lt;&quot;Good&quot;&lt;..: 5 4 2 4 2 3 3 3 1 3 ...
##  $ color  : Ord.factor w/ 7 levels &quot;D&quot;&lt;&quot;E&quot;&lt;&quot;F&quot;&lt;&quot;G&quot;&lt;..: 2 2 2 6 7 7 6 5 2 5 ...
##  $ clarity: Ord.factor w/ 8 levels &quot;I1&quot;&lt;&quot;SI2&quot;&lt;&quot;SI1&quot;&lt;..: 2 3 5 4 2 6 7 3 4 5 ...
##  $ depth  : num  61.5 59.8 56.9 62.4 63.3 62.8 62.3 61.9 65.1 59.4 ...
##  $ table  : num  55 61 65 58 58 57 57 55 61 61 ...
##  $ price  : int  326 326 327 334 335 336 336 337 337 338 ...
##  $ x      : num  3.95 3.89 4.05 4.2 4.34 3.94 3.95 4.07 3.87 4 ...
##  $ y      : num  3.98 3.84 4.07 4.23 4.35 3.96 3.98 4.11 3.78 4.05 ...
##  $ z      : num  2.43 2.31 2.31 2.63 2.75 2.48 2.47 2.53 2.49 2.39 ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># helps to break up data into sub-groups</span>

<span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(carat, price, <span class="dt">color =</span> clarity)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_grid</span>(<span class="op">~</span>cut)</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/3.5.1.4-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># depends on the trends/comparisons</span>
<span class="co"># acts as another resolution dim</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Read <code>?facet_wrap</code>. What does nrow do? What does the argument <code>ncol =</code> do? What other arguments control the layout of the individual panels? Why doesn’t <code>facet_grid()</code> have nrow and ncol argument?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?facet_wrap
<span class="co"># build a grid based on number of rows/cols</span>
<span class="co"># allows panels to fill grid by rows or columns too</span>

?facet_grid
<span class="co"># build all possible var combos based on levels of fct/as.factor(chr)</span>

<span class="co"># control order/position with levels(fct) in both</span></code></pre></div>
</div>
<div id="geoms" class="section level3">
<h3>3.6 Geoms</h3>
<ol style="list-style-type: decimal">
<li>What geom would you use to draw a line chart? A boxplot? A histogram? An area chart?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># eval = F</span>
<span class="kw">geom_line</span>()
<span class="kw">geom_boxplot</span>()
<span class="kw">geom_histogram</span>()
<span class="kw">geom_density</span>()
<span class="kw">geom_area</span>()</code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Run this code in your head and predict what the output will look like. Then, run the code in R and check your predictions.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">color =</span> drv)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># a scatter plot with a trend smooth</span>
<span class="co"># defaults to loess (Localy weighted polynomial regression)</span></code></pre></div>
<p><a href="https://en.wikipedia.org/wiki/Local_regression#Definition_of_a_LOESS_model">Local regression - Wikipedia</a></p>
<p>3a. What does show.legend = FALSE do? What happens if you remove it?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">color =</span> drv)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">show.legend =</span> F)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># removes legend for a specific layer</span>
<span class="co"># avoid/make confustion?</span></code></pre></div>
<p>3b. Why do you think I used it earlier in the chapter?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#to avoid visual confustion? tricky example?</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>What does the se argument to geom_smooth() do?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">color =</span> drv)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_smooth</span>() <span class="co"># shows a confidence interval, .95 default</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>Will these two graphs look different? Why/why not?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">color =</span> cyl, <span class="dt">group =</span> cyl)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_smooth</span>()</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-7-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># no, every sub-layer tries to inherit from the top layer, unless &quot;inherit.aes = F&quot;</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>Recreate the R code necessary to generate the following graphs.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># try to change/add one argument per interation</span>

<span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">stat_smooth</span>(<span class="dt">se =</span> F)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy, <span class="dt">group =</span> drv)) <span class="op">+</span><span class="st"> </span><span class="co"># establish a grouping var</span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">stat_smooth</span>(<span class="dt">se =</span> F)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-8-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy, <span class="dt">color =</span> drv)) <span class="op">+</span><span class="st"> </span><span class="co"># color var does grouping by default</span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">stat_smooth</span>(<span class="dt">se =</span> F)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-8-3.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy, <span class="dt">color =</span> drv)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">stat_smooth</span>(<span class="kw">aes</span>(<span class="dt">color =</span> <span class="ot">NULL</span>), <span class="dt">se =</span> F) <span class="co"># turn off color group for this layer</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-8-4.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy, <span class="dt">color =</span> drv)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">stat_smooth</span>(<span class="kw">aes</span>(<span class="dt">color =</span> <span class="ot">NULL</span>, <span class="dt">linetype =</span> drv), <span class="dt">se =</span> F) <span class="co"># turn on linetype aes for this layer</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-8-5.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy, <span class="dt">fill =</span> drv)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">stroke =</span> <span class="dv">3</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme_grey</span>()</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-8-6.png" width="672" /></p>
</div>
</div>
<div id="intro-to-dplyr" class="section level1">
<h1>5 Intro to <code>dplyr</code></h1>
<div id="filter" class="section level3">
<h3>5.2 Filter</h3>
<ol style="list-style-type: decimal">
<li>Find all flights that:</li>
<li>Had an arrival delay of two or more hours</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(nycflights13)
flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">120</span>)</code></pre></div>
<pre><code>## # A tibble: 10,034 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      811            630       101     1047
##  2  2013     1     1      848           1835       853     1001
##  3  2013     1     1      957            733       144     1056
##  4  2013     1     1     1114            900       134     1447
##  5  2013     1     1     1505           1310       115     1638
##  6  2013     1     1     1525           1340       105     1831
##  7  2013     1     1     1549           1445        64     1912
##  8  2013     1     1     1558           1359       119     1718
##  9  2013     1     1     1732           1630        62     2028
## 10  2013     1     1     1803           1620       103     2008
## # ... with 10,024 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Flew to Houston (IAH or HOU)</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(dest <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;IAH&quot;</span>, <span class="st">&quot;HOU&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 9,313 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      623            627        -4      933
##  4  2013     1     1      728            732        -4     1041
##  5  2013     1     1      739            739         0     1104
##  6  2013     1     1      908            908         0     1228
##  7  2013     1     1     1028           1026         2     1350
##  8  2013     1     1     1044           1045        -1     1352
##  9  2013     1     1     1114            900       134     1447
## 10  2013     1     1     1205           1200         5     1503
## # ... with 9,303 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Were operated by United, American, or Delta</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(carrier <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;AA&quot;</span>, <span class="st">&quot;UA&quot;</span>, <span class="st">&quot;DL&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 139,504 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      554            600        -6      812
##  5  2013     1     1      554            558        -4      740
##  6  2013     1     1      558            600        -2      753
##  7  2013     1     1      558            600        -2      924
##  8  2013     1     1      558            600        -2      923
##  9  2013     1     1      559            600        -1      941
## 10  2013     1     1      559            600        -1      854
## # ... with 139,494 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Departed in summer (July, August, and September)</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(month <span class="op">%in%</span><span class="st"> </span><span class="dv">7</span><span class="op">:</span><span class="dv">9</span>)</code></pre></div>
<pre><code>## # A tibble: 86,326 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     7     1        1           2029       212      236
##  2  2013     7     1        2           2359         3      344
##  3  2013     7     1       29           2245       104      151
##  4  2013     7     1       43           2130       193      322
##  5  2013     7     1       44           2150       174      300
##  6  2013     7     1       46           2051       235      304
##  7  2013     7     1       48           2001       287      308
##  8  2013     7     1       58           2155       183      335
##  9  2013     7     1      100           2146       194      327
## 10  2013     7     1      100           2245       135      337
## # ... with 86,316 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Arrived more than two hours late, but didn’t leave late</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">120</span>, dep_delay <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>)</code></pre></div>
<pre><code>## # A tibble: 29 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1    27     1419           1420        -1     1754
##  2  2013    10     7     1350           1350         0     1736
##  3  2013    10     7     1357           1359        -2     1858
##  4  2013    10    16      657            700        -3     1258
##  5  2013    11     1      658            700        -2     1329
##  6  2013     3    18     1844           1847        -3       39
##  7  2013     4    17     1635           1640        -5     2049
##  8  2013     4    18      558            600        -2     1149
##  9  2013     4    18      655            700        -5     1213
## 10  2013     5    22     1827           1830        -3     2217
## # ... with 19 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Were delayed by at least an hour, but made up over 30 minutes in flight</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(dep_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">60</span>, arr_delay <span class="op">&lt;</span><span class="st"> </span>(dep_delay <span class="op">-</span><span class="st"> </span><span class="dv">30</span>))</code></pre></div>
<pre><code>## # A tibble: 1,819 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1     2205           1720       285       46
##  2  2013     1     1     2326           2130       116      131
##  3  2013     1     3     1503           1221       162     1803
##  4  2013     1     3     1839           1700        99     2056
##  5  2013     1     3     1850           1745        65     2148
##  6  2013     1     3     1941           1759       102     2246
##  7  2013     1     3     1950           1845        65     2228
##  8  2013     1     3     2257           2000       177       45
##  9  2013     1     4     1917           1700       137     2135
## 10  2013     1     4     2010           1745       145     2257
## # ... with 1,809 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Departed between midnight and 6am (inclusive)</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(dep_time <span class="op">%in%</span><span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">600</span>)</code></pre></div>
<pre><code>## # A tibble: 9,344 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 9,334 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Another useful dplyr filtering helper is between(). What does it do? Can you use it to simplify the code needed to answer the previous challenges?</li>
</ol>
<p>I don’t think using <code>between()</code> is an advantage over using <code>%in%</code> operator</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(dep_time <span class="op">%in%</span><span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">600</span>)</code></pre></div>
<pre><code>## # A tibble: 9,344 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 9,334 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># vs</span>
flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">between</span>(dep_time, <span class="dv">0</span>, <span class="dv">600</span>))</code></pre></div>
<pre><code>## # A tibble: 9,344 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 9,334 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>How many flights have a missing dep_time? What other variables are missing? What might these rows represent?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">is.na</span>(dep_time)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>()</code></pre></div>
<pre><code>## [1] 8255</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">is.na</span>(dep_time)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(<span class="kw">is.na</span>(.))) <span class="co"># look for mostly na columns</span></code></pre></div>
<pre><code>## $year
## [1] 0
## 
## $month
## [1] 0
## 
## $day
## [1] 0
## 
## $dep_time
## [1] 8255
## 
## $sched_dep_time
## [1] 0
## 
## $dep_delay
## [1] 8255
## 
## $arr_time
## [1] 8255
## 
## $sched_arr_time
## [1] 0
## 
## $arr_delay
## [1] 8255
## 
## $carrier
## [1] 0
## 
## $flight
## [1] 0
## 
## $tailnum
## [1] 2512
## 
## $origin
## [1] 0
## 
## $dest
## [1] 0
## 
## $air_time
## [1] 8255
## 
## $distance
## [1] 0
## 
## $hour
## [1] 0
## 
## $minute
## [1] 0
## 
## $time_hour
## [1] 0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">is.na</span>(dep_time))</code></pre></div>
<pre><code>## # A tibble: 8,255 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1       NA           1630        NA       NA
##  2  2013     1     1       NA           1935        NA       NA
##  3  2013     1     1       NA           1500        NA       NA
##  4  2013     1     1       NA            600        NA       NA
##  5  2013     1     2       NA           1540        NA       NA
##  6  2013     1     2       NA           1620        NA       NA
##  7  2013     1     2       NA           1355        NA       NA
##  8  2013     1     2       NA           1420        NA       NA
##  9  2013     1     2       NA           1321        NA       NA
## 10  2013     1     2       NA           1545        NA       NA
## # ... with 8,245 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colSums</span>(<span class="kw">is.na</span>(flights))</code></pre></div>
<pre><code>##           year          month            day       dep_time sched_dep_time 
##              0              0              0           8255              0 
##      dep_delay       arr_time sched_arr_time      arr_delay        carrier 
##           8255           8713              0           9430              0 
##         flight        tailnum         origin           dest       air_time 
##              0           2512              0              0           9430 
##       distance           hour         minute      time_hour 
##              0              0              0              0</code></pre>
<p>Departure delay, arrival time, arrival delay and airtime are all missing in these flight records. Perhaps all of these flights were canceled.</p>
<ol start="4" style="list-style-type: decimal">
<li>Why is NA ^ 0 not missing? Why is NA | TRUE not missing? Why is FALSE &amp; NA not missing? Can you figure out the general rule? (NA * 0 is a tricky counterexample!)</li>
</ol>
<p><code>NA</code> refers to an unknown value. Depending on the operation, results will vary:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># NA represent a number (-Inf:Inf)</span>
<span class="ot">NA</span><span class="op">^</span><span class="dv">0</span> <span class="co"># all numbers raised to 0 are 1</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># NA represents a logical ( so either TRUE or FALSE )</span>
<span class="ot">NA</span> <span class="op">|</span><span class="st"> </span><span class="ot">TRUE</span> <span class="co"># regardless of NA, one TRUE in an `or` operator returns TRUE</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="ot">FALSE</span> <span class="op">&amp;</span><span class="st"> </span><span class="ot">NA</span> <span class="co"># one FALSE in an `and` operator returns FALSE</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="ot">NA</span> <span class="op">*</span><span class="st"> </span><span class="dv">0</span> <span class="co"># Inf * 0 = Inf</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
</div>
<div id="arrange" class="section level3">
<h3>5.3 Arrange</h3>
<ol style="list-style-type: decimal">
<li>How could you use arrange() to sort all missing values to the start? (Hint: use <code>is.na()</code>).</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="op">-</span><span class="kw">is.na</span>(dep_time))</code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1       NA           1630        NA       NA
##  2  2013     1     1       NA           1935        NA       NA
##  3  2013     1     1       NA           1500        NA       NA
##  4  2013     1     1       NA            600        NA       NA
##  5  2013     1     2       NA           1540        NA       NA
##  6  2013     1     2       NA           1620        NA       NA
##  7  2013     1     2       NA           1355        NA       NA
##  8  2013     1     2       NA           1420        NA       NA
##  9  2013     1     2       NA           1321        NA       NA
## 10  2013     1     2       NA           1545        NA       NA
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Sort flights to find the most delayed flights. Find the flights that left earliest.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="op">-</span>dep_delay) <span class="co"># most delayed</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     9      641            900      1301     1242
##  2  2013     6    15     1432           1935      1137     1607
##  3  2013     1    10     1121           1635      1126     1239
##  4  2013     9    20     1139           1845      1014     1457
##  5  2013     7    22      845           1600      1005     1044
##  6  2013     4    10     1100           1900       960     1342
##  7  2013     3    17     2321            810       911      135
##  8  2013     6    27      959           1900       899     1236
##  9  2013     7    22     2257            759       898      121
## 10  2013    12     5      756           1700       896     1058
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(dep_delay) <span class="co"># left earliest</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013    12     7     2040           2123       -43       40
##  2  2013     2     3     2022           2055       -33     2240
##  3  2013    11    10     1408           1440       -32     1549
##  4  2013     1    11     1900           1930       -30     2233
##  5  2013     1    29     1703           1730       -27     1947
##  6  2013     8     9      729            755       -26     1002
##  7  2013    10    23     1907           1932       -25     2143
##  8  2013     3    30     2030           2055       -25     2213
##  9  2013     3     2     1431           1455       -24     1601
## 10  2013     5     5      934            958       -24     1225
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Sort flights to find the fastest flights.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(distance <span class="op">/</span><span class="st"> </span>air_time)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1    28     1917           1825        52     2118
##  2  2013     6    29      755            800        -5     1035
##  3  2013     8    28      932            940        -8     1116
##  4  2013     1    30     1037            955        42     1221
##  5  2013    11    27      556            600        -4      727
##  6  2013     5    21      558            600        -2      721
##  7  2013    12     9     1540           1535         5     1720
##  8  2013     6    10     1356           1300        56     1646
##  9  2013     7    28     1322           1325        -3     1612
## 10  2013     4    11     1349           1345         4     1542
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">speed =</span> distance <span class="op">/</span><span class="st"> </span>air_time) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(speed)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 20
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1    28     1917           1825        52     2118
##  2  2013     6    29      755            800        -5     1035
##  3  2013     8    28      932            940        -8     1116
##  4  2013     1    30     1037            955        42     1221
##  5  2013    11    27      556            600        -4      727
##  6  2013     5    21      558            600        -2      721
##  7  2013    12     9     1540           1535         5     1720
##  8  2013     6    10     1356           1300        56     1646
##  9  2013     7    28     1322           1325        -3     1612
## 10  2013     4    11     1349           1345         4     1542
## # ... with 336,766 more rows, and 13 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, speed &lt;dbl&gt;</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Which flights travelled the longest? Which travelled the shortest?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sorted &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="op">-</span>distance) 
sorted[<span class="dv">2</span>]</code></pre></div>
<pre><code>## # A tibble: 336,776 x 1
##    month
##    &lt;int&gt;
##  1     1
##  2     1
##  3     1
##  4     1
##  5     1
##  6     1
##  7     1
##  8     1
##  9     1
## 10     1
## # ... with 336,766 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">slice</span>(sorted, <span class="dv">5</span>)</code></pre></div>
<pre><code>## # A tibble: 1 x 19
##    year month   day dep_time sched_dep_time dep_delay arr_time
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
## 1  2013     1     5      858            900        -2     1519
## # ... with 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># longest</span>
flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(distance) <span class="co"># shortest</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     7    27       NA            106        NA       NA
##  2  2013     1     3     2127           2129        -2     2222
##  3  2013     1     4     1240           1200        40     1333
##  4  2013     1     4     1829           1615       134     1937
##  5  2013     1     4     2128           2129        -1     2218
##  6  2013     1     5     1155           1200        -5     1241
##  7  2013     1     6     2125           2129        -4     2224
##  8  2013     1     7     2124           2129        -5     2212
##  9  2013     1     8     2127           2130        -3     2304
## 10  2013     1     9     2126           2129        -3     2217
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="select" class="section level3">
<h3>5.4 Select</h3>
<ol style="list-style-type: decimal">
<li>Brainstorm as many ways as possible to select dep_time, dep_delay, arr_time, and arr_delay from flights.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">matches</span>(<span class="st">&quot;^dep|^arr&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##    dep_time dep_delay arr_time arr_delay
##       &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1      517         2      830        11
##  2      533         4      850        20
##  3      542         2      923        33
##  4      544        -1     1004       -18
##  5      554        -6      812       -25
##  6      554        -4      740        12
##  7      555        -5      913        19
##  8      557        -3      709       -14
##  9      557        -3      838        -8
## 10      558        -2      753         8
## # ... with 336,766 more rows</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>What happens if you include the name of a variable multiple times in a select() call?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(arr_time, arr_time)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 1
##    arr_time
##       &lt;int&gt;
##  1      830
##  2      850
##  3      923
##  4     1004
##  5      812
##  6      740
##  7      913
##  8      709
##  9      838
## 10      753
## # ... with 336,766 more rows</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>What does the one_of() function do? Why might it be helpful in conjunction with this vector?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;dep_delay&quot;</span>, <span class="st">&quot;arr_delay&quot;</span>)
flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">one_of</span>(vars)) <span class="co"># selects any matching columns from vars</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 5
##     year month   day dep_delay arr_delay
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1  2013     1     1         2        11
##  2  2013     1     1         4        20
##  3  2013     1     1         2        33
##  4  2013     1     1        -1       -18
##  5  2013     1     1        -6       -25
##  6  2013     1     1        -4        12
##  7  2013     1     1        -5        19
##  8  2013     1     1        -3       -14
##  9  2013     1     1        -3        -8
## 10  2013     1     1        -2         8
## # ... with 336,766 more rows</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Does the result of running the following code surprise you? How do the select helpers deal with case by default? How can you change that default?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(flights, <span class="kw">contains</span>(<span class="st">&quot;TIME&quot;</span>)) <span class="co"># ignore.case == TRUE is default</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 6
##    dep_time sched_dep_time arr_time sched_arr_time air_time
##       &lt;int&gt;          &lt;int&gt;    &lt;int&gt;          &lt;int&gt;    &lt;dbl&gt;
##  1      517            515      830            819      227
##  2      533            529      850            830      227
##  3      542            540      923            850      160
##  4      544            545     1004           1022      183
##  5      554            600      812            837      116
##  6      554            558      740            728      150
##  7      555            600      913            854      158
##  8      557            600      709            723       53
##  9      557            600      838            846      140
## 10      558            600      753            745      138
## # ... with 336,766 more rows, and 1 more variables: time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(flights, <span class="kw">contains</span>(<span class="st">&quot;TIME&quot;</span>, <span class="dt">ignore.case =</span> <span class="ot">FALSE</span>)) <span class="co"># matches nothing</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 0</code></pre>
</div>
<div id="mutate" class="section level3">
<h3>5.5 Mutate</h3>
<ol style="list-style-type: decimal">
<li>Currently dep_time and sched_dep_time are convenient to look at, but hard to compute with because they’re not really continuous numbers. Convert them to a more convenient representation of number of minutes since midnight.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">transmute</span>(<span class="dt">new_dep_time =</span> (dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>)<span class="op">*</span><span class="dv">60</span> <span class="op">+</span><span class="st"> </span>(dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>) )</code></pre></div>
<pre><code>## # A tibble: 336,776 x 1
##    new_dep_time
##           &lt;dbl&gt;
##  1          317
##  2          333
##  3          342
##  4          344
##  5          354
##  6          354
##  7          355
##  8          357
##  9          357
## 10          358
## # ... with 336,766 more rows</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Compare <code>air_time</code> with <code>arr_time - dep_time</code>. What do you expect to see? What do you see? What do you need to do to fix it?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">transmute</span>(air_time, <span class="dt">new_diff =</span> arr_time <span class="op">-</span><span class="st"> </span>dep_time)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 2
##    air_time new_diff
##       &lt;dbl&gt;    &lt;int&gt;
##  1      227      313
##  2      227      317
##  3      160      381
##  4      183      460
##  5      116      258
##  6      150      186
##  7      158      358
##  8       53      152
##  9      140      281
## 10      138      195
## # ... with 336,766 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># need to convert to minutes first</span>
flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">arr_time =</span> (arr_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>)<span class="op">*</span><span class="dv">60</span> <span class="op">+</span><span class="st"> </span>(arr_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>),
                   <span class="dt">dep_time =</span> (dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>)<span class="op">*</span><span class="dv">60</span> <span class="op">+</span><span class="st"> </span>(dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>) ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">transmute</span>(air_time, <span class="dt">new_diff =</span> arr_time <span class="op">-</span><span class="st"> </span>dep_time)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 2
##    air_time new_diff
##       &lt;dbl&gt;    &lt;dbl&gt;
##  1      227      193
##  2      227      197
##  3      160      221
##  4      183      260
##  5      116      138
##  6      150      106
##  7      158      198
##  8       53       72
##  9      140      161
## 10      138      115
## # ... with 336,766 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># now adjust for tz</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Compare dep_time, sched_dep_time, and dep_delay. How would you expect those three numbers to be related?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># dep_time should equal sum(sched_dep_time, dep_delay)</span>
flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">transmute</span>(dep_time, <span class="dt">sum_dep =</span> <span class="kw">sum</span>(sched_dep_time, dep_delay, <span class="dt">na.rm =</span> T))</code></pre></div>
<pre><code>## Source: local data frame [336,776 x 2]
## Groups: &lt;by row&gt;
## 
## # A tibble: 336,776 x 2
##    dep_time sum_dep
##       &lt;int&gt;   &lt;dbl&gt;
##  1      517     517
##  2      533     533
##  3      542     542
##  4      544     544
##  5      554     594
##  6      554     554
##  7      555     595
##  8      557     597
##  9      557     597
## 10      558     598
## # ... with 336,766 more rows</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Find the 10 most delayed flights using a ranking function. How do you want to handle ties? Carefully read the documentation for min_rank().</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="op">-</span>dep_delay) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</code></pre></div>
<pre><code>## # A tibble: 10 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     9      641            900      1301     1242
##  2  2013     6    15     1432           1935      1137     1607
##  3  2013     1    10     1121           1635      1126     1239
##  4  2013     9    20     1139           1845      1014     1457
##  5  2013     7    22      845           1600      1005     1044
##  6  2013     4    10     1100           1900       960     1342
##  7  2013     3    17     2321            810       911      135
##  8  2013     6    27      959           1900       899     1236
##  9  2013     7    22     2257            759       898      121
## 10  2013    12     5      756           1700       896     1058
## # ... with 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">top_n</span>(<span class="dv">10</span>, dep_delay)</code></pre></div>
<pre><code>## # A tibble: 10 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     9      641            900      1301     1242
##  2  2013     1    10     1121           1635      1126     1239
##  3  2013    12     5      756           1700       896     1058
##  4  2013     3    17     2321            810       911      135
##  5  2013     4    10     1100           1900       960     1342
##  6  2013     6    15     1432           1935      1137     1607
##  7  2013     6    27      959           1900       899     1236
##  8  2013     7    22      845           1600      1005     1044
##  9  2013     7    22     2257            759       898      121
## 10  2013     9    20     1139           1845      1014     1457
## # ... with 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>What does 1:3 + 1:10 return? Why? R will attempt to “recycle” the shorter of the two lists until all of the values in the longer list have been evaluated. If the shorter this is not a multiple of the longer, then a warning will be raised.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">1</span><span class="op">:</span><span class="dv">3</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span> <span class="co"># warning</span></code></pre></div>
<pre><code>## Warning in 1:3 + 1:10: longer object length is not a multiple of shorter
## object length</code></pre>
<pre><code>##  [1]  2  4  6  5  7  9  8 10 12 11</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">1</span><span class="op">:</span><span class="dv">10</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">2</span> <span class="co"># no warning</span></code></pre></div>
<pre><code>##  [1]  2  4  4  6  6  8  8 10 10 12</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">1</span><span class="op">:</span><span class="dv">10</span> <span class="op">+</span><span class="st"> </span><span class="dv">5</span> <span class="co"># no warning</span></code></pre></div>
<pre><code>##  [1]  6  7  8  9 10 11 12 13 14 15</code></pre>
<p>What trigonometric functions does R provide?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?sin <span class="co"># a lot of them</span></code></pre></div>
</div>
<div id="summarise" class="section level3">
<h3>5.6 Summarise</h3>
<p>Useful objects from section 5.6 for exercises:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_cancelled &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(dep_delay), <span class="op">!</span><span class="kw">is.na</span>(arr_delay))

cancelled &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, <span class="kw">is.na</span>(air_time))</code></pre></div>
<ol style="list-style-type: decimal">
<li>Brainstorm at least 5 different ways to assess the typical delay characteristics of a group of flights. Consider the following scenarios:</li>
</ol>
<p>— 1a. A flight is 15 minutes early 50% of the time, and 15 minutes late 50% of the time.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_cancelled <span class="op">%&gt;%</span>
<span class="st">    </span><span class="co"># conditional booleans</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">early_15 =</span> arr_delay <span class="op">&lt;</span><span class="st"> </span><span class="op">-</span><span class="dv">15</span>,
           <span class="dt">late_15 =</span> arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">15</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(flight) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="co"># sum/count TRUEs and calculate percentage with n() for group counts</span>
<span class="st">    </span><span class="kw">summarise</span>( <span class="dt">percent_early15 =</span> <span class="kw">sum</span>(early_<span class="dv">15</span>) <span class="op">/</span><span class="st"> </span><span class="kw">n</span>(),
               <span class="dt">percent_late15 =</span> <span class="kw">sum</span>(late_<span class="dv">15</span>) <span class="op">/</span><span class="st"> </span><span class="kw">n</span>() ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(percent_early15 <span class="op">&gt;</span><span class="st"> </span>.<span class="dv">5</span> <span class="op">&amp;</span><span class="st"> </span>percent_late15 <span class="op">&gt;</span><span class="st"> </span>.<span class="dv">5</span>) <span class="co"># they don&#39;t exist, bc how could it add up to more than 100%</span></code></pre></div>
<pre><code>## # A tibble: 0 x 3
## # ... with 3 variables: flight &lt;int&gt;, percent_early15 &lt;dbl&gt;,
## #   percent_late15 &lt;dbl&gt;</code></pre>
<p>— 1b. A flight is always 10 minutes late.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(flight) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">avg_dep_delay =</span> <span class="kw">mean</span>(dep_delay)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(avg_dep_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(<span class="op">-</span>avg_dep_delay) <span class="co"># whoa thats ridiculous, a 5 hour average delay!!!</span></code></pre></div>
<pre><code>## # A tibble: 759 x 2
##    flight avg_dep_delay
##     &lt;int&gt;         &lt;dbl&gt;
##  1   1510      278.0000
##  2   5478      242.0000
##  3   5117      219.0000
##  4   5855      209.0000
##  5   5294      192.0000
##  6   6082      153.0000
##  7   1226      147.0000
##  8   6093      128.0000
##  9   5015      124.0000
## 10   5017      123.3333
## # ... with 749 more rows</code></pre>
<p>— 1c. A flight is 30 minutes early 50% of the time, and 30 minutes late 50% of the time.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># this can&#39;t happend, see answer 1a for proof/code_template</span></code></pre></div>
<p>— 1d. 99% of the time a flight is on time. 1% of the time it’s 2 hours late.</p>
<p>(I adjusted question because the original conditionals don’t exist in <code>flights</code>)</p>
<p>— 1d_adj. 90% of the time a flight is on time. 1% of the time it’s 2 hours late.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_cancelled <span class="op">%&gt;%</span>
<span class="st">    </span><span class="co"># conditional booleans</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">on_time =</span> arr_delay <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>,
           <span class="dt">late_2hrs=</span> arr_delay <span class="op">&gt;=</span><span class="st"> </span><span class="dv">120</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(flight) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="co"># sum/count TRUEs and calculate percentage with n() for group counts</span>
<span class="st">    </span><span class="kw">summarise</span>( <span class="dt">percent_on_time =</span> <span class="kw">sum</span>(on_time) <span class="op">/</span><span class="st"> </span><span class="kw">n</span>(),
               <span class="dt">percent_late_2hrs =</span> <span class="kw">sum</span>(late_2hrs) <span class="op">/</span><span class="st"> </span><span class="kw">n</span>() ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(percent_on_time <span class="op">&gt;=</span><span class="st"> </span>.<span class="dv">90</span>, percent_late_2hrs <span class="op">&gt;</span><span class="st"> </span>.<span class="dv">01</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(<span class="op">-</span>percent_late_2hrs)</code></pre></div>
<pre><code>## # A tibble: 5 x 3
##   flight percent_on_time percent_late_2hrs
##    &lt;int&gt;           &lt;dbl&gt;             &lt;dbl&gt;
## 1   1836       0.9000000        0.10000000
## 2   3613       0.9117647        0.02941176
## 3   2174       0.9142857        0.02857143
## 4   5288       0.9268293        0.02439024
## 5   2243       0.9075630        0.01680672</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Which is more important: arrival delay or departure delay?</li>
</ol>
<p>Arrival delay. The reason people fly is to get to a place by a certain time.</p>
<ol start="3" style="list-style-type: decimal">
<li>Come up with another approach that will give you the same output as <code>not_cancelled %&gt;% count(dest)</code> and <code>not_cancelled %&gt;% count(tailnum, wt = distance)</code> (without using <code>count()</code>).</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># not_cancelled %&gt;% count(dest)</span>
not_cancelled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">tally</span>()</code></pre></div>
<pre><code>## # A tibble: 104 x 2
##     dest     n
##    &lt;chr&gt; &lt;int&gt;
##  1   ABQ   254
##  2   ACK   264
##  3   ALB   418
##  4   ANC     8
##  5   ATL 16837
##  6   AUS  2411
##  7   AVL   261
##  8   BDL   412
##  9   BGR   358
## 10   BHM   269
## # ... with 94 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># not_cancelled %&gt;% count(tailnum, wt = distance)</span>
not_cancelled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">group_distance =</span> <span class="kw">sum</span>(distance))</code></pre></div>
<pre><code>## # A tibble: 4,037 x 2
##    tailnum group_distance
##      &lt;chr&gt;          &lt;dbl&gt;
##  1  D942DN           3418
##  2  N0EGMQ         239143
##  3  N10156         109664
##  4  N102UW          25722
##  5  N103US          24619
##  6  N104UW          24616
##  7  N10575         139903
##  8  N105UW          23618
##  9  N107US          21677
## 10  N108UW          32070
## # ... with 4,027 more rows</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Our definition of cancelled flights <code>(is.na(dep_delay) | is.na(arr_delay)</code> ) is slightly suboptimal. Why? Which is the most important column?</li>
</ol>
<p><code>arr_delay</code> appears to have identical coverage to what I would guess would be the best column/var <code>air_time</code>. So either var covers sufficently…</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(dep_delay, arr_delay, air_time) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(<span class="kw">is.na</span>(.)))</code></pre></div>
<pre><code>## $dep_delay
## [1] 8255
## 
## $arr_delay
## [1] 9430
## 
## $air_time
## [1] 9430</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Look at the number of cancelled flights per day. Is there a pattern? Is the proportion of cancelled flights related to the average delay?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># scale the vars (year, month, day) to numeric</span>
cancelled <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">transmute</span>(<span class="dt">time_scale =</span> (month<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span><span class="dv">30</span> <span class="op">+</span><span class="st"> </span>day) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># rough but good enough</span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(time_scale)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_density</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">360</span>, <span class="dv">30</span>),
                       <span class="dt">labels =</span> <span class="kw">seq</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>)) <span class="co"># crude month markers, but good enough</span></code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># better built-in fxns exist...?scale_x_datetime</span></code></pre></div>
<p>Looks like local maxima are found near major holidays: Valentine’s Day, July 4th and Christmas. I would have guess Thanksgiving would be a big cancel event, maybe if we looked at more data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(month, day) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">prop_canceled =</span> <span class="kw">sum</span>(<span class="kw">is.na</span>(air_time)) <span class="op">/</span><span class="st"> </span><span class="kw">n</span>(),
              <span class="dt">avg_dep_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">time_scale =</span> (month<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span><span class="dv">30</span> <span class="op">+</span><span class="st"> </span>day) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(avg_dep_delay, prop_canceled)) <span class="op">+</span>
<span class="st">        </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">        </span><span class="kw">stat_smooth</span>()</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<p>Looks like a weak positive correlation between the average departure delay and the proportional of flights canceled when grouped by day of year.</p>
<ol start="6" style="list-style-type: decimal">
<li>Which carrier has the worst delays?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(carrier) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">count</span>(<span class="dt">wt =</span> dep_delay, <span class="dt">sort =</span> T)</code></pre></div>
<pre><code>## # A tibble: 16 x 2
## # Groups:   carrier [16]
##    carrier       n
##      &lt;chr&gt;   &lt;dbl&gt;
##  1      EV 1024829
##  2      B6  705417
##  3      UA  701898
##  4      DL  442482
##  5      9E  291296
##  6      AA  275551
##  7      MQ  265521
##  8      WN  214011
##  9      US   75168
## 10      VX   66033
## 11      FL   59680
## 12      F9   13787
## 13      YV   10353
## 14      AS    4133
## 15      HA    1676
## 16      OO     365</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Express Jet</span></code></pre></div>
<p>— Challenge: can you disentangle the effects of bad airports vs. bad carriers? Why/why not? (Hint: think about flights %&gt;% group_by(carrier, dest) %&gt;% summarise(n()))</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># viz that shiz</span>
not_cancelled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(carrier, origin) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># using origin to restrict to NYC not the world ;)</span>
<span class="st">    </span><span class="kw">count</span>(<span class="dt">wt =</span> dep_delay, <span class="dt">sort =</span> T) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(origin, n, <span class="dt">fill =</span> carrier)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_col</span>() <span class="op">+</span>
<span class="st">    </span>ggsci<span class="op">::</span><span class="kw">scale_fill_d3</span>(<span class="st">&quot;category20&quot;</span>)</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<p>Newark Liberty Internation Airport is the most delayed NYC airport, and it looks like ExpressJet is the worst carrier in terms of total delays across the major airports of NYC.</p>
<ol start="7" style="list-style-type: decimal">
<li>What does the sort argument to count() do. When might you use it?</li>
</ol>
<p>It is short hand for adding <code>%&gt;% arrange(-n)</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">count</span>(flights, carrier, <span class="dt">sort =</span> T)</code></pre></div>
<pre><code>## # A tibble: 16 x 2
##    carrier     n
##      &lt;chr&gt; &lt;int&gt;
##  1      UA 58665
##  2      B6 54635
##  3      EV 54173
##  4      DL 48110
##  5      AA 32729
##  6      MQ 26397
##  7      US 20536
##  8      9E 18460
##  9      WN 12275
## 10      VX  5162
## 11      FL  3260
## 12      AS   714
## 13      F9   685
## 14      YV   601
## 15      HA   342
## 16      OO    32</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">count</span>(flights, carrier) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(<span class="op">-</span>n)</code></pre></div>
<pre><code>## # A tibble: 16 x 2
##    carrier     n
##      &lt;chr&gt; &lt;int&gt;
##  1      UA 58665
##  2      B6 54635
##  3      EV 54173
##  4      DL 48110
##  5      AA 32729
##  6      MQ 26397
##  7      US 20536
##  8      9E 18460
##  9      WN 12275
## 10      VX  5162
## 11      FL  3260
## 12      AS   714
## 13      F9   685
## 14      YV   601
## 15      HA   342
## 16      OO    32</code></pre>
</div>
<div id="grouped-mutate" class="section level2">
<h2>5.7 Grouped mutate</h2>
<ol style="list-style-type: decimal">
<li>Refer back to the lists of useful mutate and filtering functions. Describe how each operation changes when you combine it with grouping.</li>
</ol>
<p><code>mutate()</code> will add a new column with the group-wise value. So the new column will have the same length of the data.frame but will have repeated values corresponding to the groups.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(flight) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">avg_dep_delay =</span> <span class="kw">mean</span>(dep_delay))</code></pre></div>
<pre><code>## # A tibble: 336,776 x 20
## # Groups:   flight [3,844]
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 13 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, avg_dep_delay &lt;dbl&gt;</code></pre>
<p><code>filter()</code> will perform the filtering on each group separatly, similar to <code>tapply()</code> where a data.frame is split, an operation is performed on each piece and the data.frame is reconsituted into a whole. So in the case below we will get a smaller data.frame with only the observation of the maximum departure delay for each flight id.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_cancelled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(flight) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(dep_delay <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(dep_delay))</code></pre></div>
<pre><code>## # A tibble: 3,894 x 19
## # Groups:   flight [3,835]
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      559            559         0      702
##  2  2013     1     1      840            845        -5     1053
##  3  2013     1     1      848           1835       853     1001
##  4  2013     1     1      927            930        -3     1231
##  5  2013     1     1      933            935        -2     1120
##  6  2013     1     1      957            733       144     1056
##  7  2013     1     1     1114            900       134     1447
##  8  2013     1     1     1144           1145        -1     1422
##  9  2013     1     1     1327           1329        -2     1624
## 10  2013     1     1     1336           1340        -4     1508
## # ... with 3,884 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Which plane (tailnum) has the worst on-time record?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_cancelled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">pct_arr_delay =</span> <span class="kw">sum</span>(arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">/</span><span class="st"> </span><span class="kw">n</span>())) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">top_n</span>(<span class="dv">1</span>, pct_arr_delay)</code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   tailnum pct_arr_delay
##     &lt;chr&gt;         &lt;int&gt;
## 1  N725MQ           215</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>What time of day should you fly if you want to avoid delays as much as possible?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_cancelled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(time_hour, <span class="kw">c</span>(<span class="st">&quot;date&quot;</span>, <span class="st">&quot;time&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(time) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">avg_dep_delay =</span> <span class="kw">mean</span>(dep_delay)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(time, avg_dep_delay)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_col</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">45</span>, <span class="dt">vjust =</span> .<span class="dv">75</span>, <span class="dt">hjust =</span> .<span class="dv">75</span>))</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<ol start="4" style="list-style-type: decimal">
<li>For each destination, compute the total minutes of delay. For each, flight, compute the proportion of the total delay for its destination.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_cancelled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">total_delay =</span> <span class="kw">sum</span>(dep_delay),
              <span class="dt">avg_delay =</span> <span class="kw">mean</span>(dep_delay)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(<span class="op">-</span>total_delay)</code></pre></div>
<pre><code>## # A tibble: 104 x 3
##     dest total_delay avg_delay
##    &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
##  1   ORD      222528 13.432814
##  2   ATL      209202 12.425135
##  3   SFO      167807 12.738708
##  4   MCO      157343 11.265340
##  5   FLL      150899 12.683786
##  6   LAX      149863  9.351242
##  7   BOS      130121  8.662029
##  8   CLT      125752  9.196431
##  9   DEN      107855 15.044637
## 10   DTW      105821 11.717529
## # ... with 94 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_cancelled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">total_delay =</span> <span class="kw">sum</span>(dep_delay)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(flight, <span class="dt">add =</span> T) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># by default group_by() ungroups previous groupings, add = TRUE overrides this</span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">pct_total =</span> <span class="kw">sum</span>(dep_delay) <span class="op">/</span><span class="st"> </span><span class="kw">unique</span>(total_delay))</code></pre></div>
<pre><code>## # A tibble: 11,421 x 3
## # Groups:   dest [?]
##     dest flight    pct_total
##    &lt;chr&gt;  &lt;int&gt;        &lt;dbl&gt;
##  1   ABQ     65 0.3550143266
##  2   ABQ   1505 0.6449856734
##  3   ACK   1191 0.3554641598
##  4   ACK   1195 0.0193889542
##  5   ACK   1291 0.1468860165
##  6   ACK   1491 0.4782608696
##  7   ALB   3256 0.0006121824
##  8   ALB   3260 0.0121416182
##  9   ALB   3264 0.0001020304
## 10   ALB   3811 0.0581573309
## # ... with 11,411 more rows</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Delays are typically temporally correlated: even once the problem that caused the initial delay has been resolved, later flights are delayed to allow earlier flights to leave. Using lag() explore how the delay of a flight is related to the delay of the immediately preceding flight.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_cancelled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unite</span>(date, month, day) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(origin, date) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(sched_dep_time) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">delay_lag =</span> <span class="kw">lag</span>(dep_delay))</code></pre></div>
<pre><code>## # A tibble: 327,346 x 19
## # Groups:   origin, date [1,095]
##     year  date dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;chr&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013   1_2      458            500        -2      703            650
##  2  2013   1_3      458            500        -2      650            650
##  3  2013   1_4      456            500        -4      631            650
##  4  2013   1_5      458            500        -2      640            650
##  5  2013   1_6      458            500        -2      718            650
##  6  2013   1_7      454            500        -6      637            648
##  7  2013   1_8      454            500        -6      625            648
##  8  2013   1_9      457            500        -3      647            648
##  9  2013  1_10      450            500       -10      634            648
## 10  2013  1_11      453            500        -7      643            648
## # ... with 327,336 more rows, and 12 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;, delay_lag &lt;dbl&gt;</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Look at each destination. Can you find flights that are suspiciously fast? (i.e. flights that represent a potential data entry error). Compute the air time a flight relative to the shortest flight to that destination. Which flights were most delayed in the air?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># super fast</span>
not_cancelled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">speed =</span> distance <span class="op">/</span><span class="st"> </span>air_time) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(<span class="op">-</span>speed)</code></pre></div>
<pre><code>## # A tibble: 327,346 x 20
## # Groups:   dest [104]
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     5    25     1709           1700         9     1923
##  2  2013     7     2     1558           1513        45     1745
##  3  2013     5    13     2040           2025        15     2225
##  4  2013     3    23     1914           1910         4     2045
##  5  2013     1    12     1559           1600        -1     1849
##  6  2013    11    17      650            655        -5     1059
##  7  2013     2    21     2355           2358        -3      412
##  8  2013    11    17      759            800        -1     1212
##  9  2013    11    16     2003           1925        38       17
## 10  2013    11    16     2349           2359       -10      402
## # ... with 327,336 more rows, and 13 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, speed &lt;dbl&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># shortest flight per destination</span>
not_cancelled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(air_time <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(air_time)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(dest, <span class="dt">min_air =</span> air_time) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">inner_join</span>(flights, <span class="dt">by =</span> <span class="st">&quot;dest&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">relative_air =</span> air_time <span class="op">/</span><span class="st"> </span>min_air) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(<span class="op">-</span>relative_air)</code></pre></div>
<pre><code>## # A tibble: 549,643 x 21
## # Groups:   dest [104]
##     dest min_air  year month   day dep_time sched_dep_time dep_delay
##    &lt;chr&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
##  1   BOS      21  2013     6    24     1932           1920        12
##  2   BOS      21  2013     6    17     1652           1700        -8
##  3   BOS      21  2013     7    23     1605           1400       125
##  4   BOS      21  2013     7    23     1617           1605        12
##  5   BOS      21  2013     7    23     1242           1237         5
##  6   BOS      21  2013     7    23     1200           1200         0
##  7   BOS      21  2013     2    17      841            840         1
##  8   BOS      21  2013     7    23     1242           1245        -3
##  9   DCA      32  2013     6    10     1356           1300        56
## 10   DCA      32  2013     6    10     1356           1300        56
## # ... with 549,633 more rows, and 13 more variables: arr_time &lt;int&gt;,
## #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, relative_air &lt;dbl&gt;</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Find all destinations that are flown by at least two carriers. Use that information to rank the carriers.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_cancelled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">num_carriers =</span> <span class="kw">length</span>(<span class="kw">unique</span>(carrier))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(num_carriers <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(carrier, <span class="dt">add =</span> T) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">avg_dep_delay =</span> <span class="kw">mean</span>(dep_delay)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">rank =</span> <span class="kw">dense_rank</span>(avg_dep_delay)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(carrier) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">avg_rank =</span> <span class="kw">mean</span>(rank)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(avg_rank)</code></pre></div>
<pre><code>## # A tibble: 16 x 2
##    carrier avg_rank
##      &lt;chr&gt;    &lt;dbl&gt;
##  1      AS 1.000000
##  2      HA 1.000000
##  3      DL 2.000000
##  4      US 2.000000
##  5      MQ 2.421053
##  6      AA 2.526316
##  7      UA 2.666667
##  8      9E 2.744681
##  9      VX 2.750000
## 10      WN 2.800000
## 11      B6 3.000000
## 12      EV 3.220000
## 13      FL 3.500000
## 14      OO 3.600000
## 15      F9 4.000000
## 16      YV 4.000000</code></pre>
<ol start="8" style="list-style-type: decimal">
<li>For each plane, count the number of flights before the first delay of greater than 1 hour.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_cancelled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(time_hour) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">num_before_big_delay =</span> <span class="kw">sum</span>(<span class="kw">cumall</span>(dep_delay <span class="op">&lt;</span><span class="dv">60</span>)))</code></pre></div>
<pre><code>## # A tibble: 327,346 x 20
## # Groups:   tailnum [4,037]
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            558        -4      740
##  6  2013     1     1      559            559         0      702
##  7  2013     1     1      554            600        -6      812
##  8  2013     1     1      555            600        -5      913
##  9  2013     1     1      557            600        -3      709
## 10  2013     1     1      557            600        -3      838
## # ... with 327,336 more rows, and 13 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, num_before_big_delay &lt;int&gt;</code></pre>
</div>
</div>
<div id="eda" class="section level1">
<h1>7 EDA</h1>
<div id="variation" class="section level3">
<h3>7.3 Variation</h3>
<ol style="list-style-type: decimal">
<li>Explore the distribution of each of the x, y, and z variables in diamonds. What do you learn? Think about a diamond and how you might decide which dimension is the length, width, and depth.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(diamonds)
<span class="kw">gather</span>(diamonds, k, v, x<span class="op">:</span>z) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(v)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_histogram</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span>k) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlim</span>(<span class="dv">0</span>,<span class="dv">10</span>)</code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<pre><code>## Warning: Removed 11 rows containing non-finite values (stat_bin).</code></pre>
<p><img src="r4ds_exercises_files/figure-html/7.3.1-1.png" width="672" /> Z always seems the thinnest, and that makes sense if the diamond is set, it would likely be oriented to show with the thinnest dimension in the z-axis show the largest sides a presented in profile in the x and y dimensions.</p>
<ol start="2" style="list-style-type: decimal">
<li>Explore the distribution of price. Do you discover anything unusual or surprising? (Hint: Carefully think about the binwidth and make sure you try a wide range of values.)</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(price)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">1000</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">15000</span>, <span class="dv">1000</span>))</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-49-1.png" width="672" /> Why are there no diamonds being sold for $1500???</p>
<ol start="3" style="list-style-type: decimal">
<li>How many diamonds are 0.99 carat? How many are 1 carat? What do you think is the cause of the difference?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diamonds <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(carat <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(.<span class="dv">99</span>, <span class="dv">1</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">with</span>(., <span class="kw">table</span>(carat))</code></pre></div>
<pre><code>## carat
## 0.99    1 
##   23 1558</code></pre>
<p>When raw diamonds are being cut, it makes sense that jewlers would strive to keep diamonds as a whole carats. It is a better marketing piece to say 1,2 or 3 carat than .99, 1.99, 2.99, no one wants an almost.</p>
<ol start="4" style="list-style-type: decimal">
<li>Compare and contrast coord_cartesian() vs xlim() or ylim() when zooming in on a histogram. What happens if you leave binwidth unset? What happens if you try and zoom so only half a bar shows?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(carat)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_histogram</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">3</span>)) <span class="op">+</span><span class="st"> </span><span class="co">#visual zoom, all data stays</span>
<span class="st">    </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">10000</span>)) <span class="co"># data outside range is converted to NA, dropped</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_bar).</code></pre>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
</div>
<div id="missing-values" class="section level3">
<h3>7.4 Missing values</h3>
<p>What happens to missing values in a histogram? What happens to missing values in a bar chart? Why is there a difference?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(flights, <span class="kw">aes</span>(dep_delay)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>()</code></pre></div>
<pre><code>## Warning: Removed 8255 rows containing non-finite values (stat_count).</code></pre>
<p><img src="r4ds_exercises_files/figure-html/7.4.1-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(flights, <span class="kw">aes</span>(dep_delay)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_histogram</span>()</code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<pre><code>## Warning: Removed 8255 rows containing non-finite values (stat_bin).</code></pre>
<p><img src="r4ds_exercises_files/figure-html/7.4.1-2.png" width="672" /></p>
<p>It seems like they handle the missing values the same, by giving a “Warning” and dropping them. Setting <code>na.rm = TRUE</code> would skip the warning and do the dropping silently.</p>
<ol start="2" style="list-style-type: decimal">
<li>What does na.rm = TRUE do in mean() and sum()?</li>
</ol>
<p>Saves you from getting the result of NA is NAs are present in your input vector. Remember NAs are “contagious” so any numeric summary would also be unknown because the NA values could be any number from -Inf to inf</p>
</div>
<div id="covariation" class="section level3">
<h3>7.5 Covariation</h3>
</div>
<div id="continuous---categorical" class="section level3">
<h3>7.5.1 Continuous - Categorical</h3>
<ol style="list-style-type: decimal">
<li>Use what you’ve learned to improve the visualisation of the departure times of cancelled vs. non-cancelled flights.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">is_cancelled =</span> <span class="kw">is.na</span>(dep_time)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(sched_dep_time)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_density</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span>is_cancelled)</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/7.5.1-1.png" width="672" /></p>
<p>Most cancelled flights happend later in the day. There is a period between midnight and 5 am were there are very few flights departing NYC airports, I guess even pilots and air traffic personel like the sleep. Also considering that each plan (<code>tailnum</code>) makes multiple flights per day, if one earlier flight is delayed every subsequent flight is also delayed increasing the risk of cancellation as the day progresses.</p>
<ol start="2" style="list-style-type: decimal">
<li>What variable in the diamonds dataset is most important for predicting the price of a diamond? How is that variable correlated with cut? Why does the combination of those two relationships lead to lower quality diamonds being more expensive?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(GGally)</code></pre></div>
<pre><code>## 
## Attaching package: &#39;GGally&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     nasa</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">small_diamonds &lt;-<span class="st"> </span><span class="kw">sample_n</span>(diamonds, <span class="dv">1000</span>) <span class="co"># so it won&#39;t take forever</span>
<span class="kw">ggpairs</span>(small_diamonds, <span class="dt">columns =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>)) <span class="co"># drop dimensions (table,x,y,z)</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="r4ds_exercises_files/figure-html/7.5.1.2-1.png" width="672" /></p>
<p><code>carat</code> looks like it has a strong linear correlation with <code>price</code>. Let’s look closer and see how it relates to <code>cut</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggbeeswarm)
<span class="kw">library</span>(cowplot)</code></pre></div>
<pre><code>## 
## Attaching package: &#39;cowplot&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     ggsave</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cowplot<span class="op">::</span><span class="kw">plot_grid</span>(
    <span class="kw">ggplot</span>(small_diamonds, <span class="kw">aes</span>(carat, price, <span class="dt">color =</span> cut)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> .<span class="dv">5</span>),
    <span class="kw">ggplot</span>(small_diamonds, <span class="kw">aes</span>(cut, price)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_quasirandom</span>(<span class="dt">alpha =</span> .<span class="dv">1</span>)
)</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/7.5.1.2b-1.png" width="672" /></p>
<p>It looks like the biggest diamonds available are not “ideal” in their cut, but despite that people are still willing to pay a premium. However it looks like <code>cut</code> is does have a positive correlation with <code>price</code>. Overall there a lot more diamonds being classified as “ideal” and that makes sense because diamonds are an artificial market driven entirely by mining company supply restrictions and advertising. Lower quality diamonds make there way into industrial applications, for their strength properties and the better cuts are left for the premiums in the jewlery market.</p>
<ol start="3" style="list-style-type: decimal">
<li>Install the ggstance package, and create a horizontal boxplot. How does this compare to using coord_flip()?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages(&quot;ggstance&quot;)</span>
<span class="kw">library</span>(ggstance)</code></pre></div>
<pre><code>## 
## Attaching package: &#39;ggstance&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:ggplot2&#39;:
## 
##     geom_errorbarh, GeomErrorbarh</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(small_diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> price, <span class="dt">y =</span> cut)) <span class="op">+</span>
<span class="st">    </span><span class="kw">stat_boxploth</span>()</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># you just have to change the axis assignments</span>
<span class="kw">ggplot</span>(small_diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> price)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-52-2.png" width="672" /></p>
<ol start="4" style="list-style-type: decimal">
<li>One problem with boxplots is that they were developed in an era of much smaller datasets and tend to display a prohibitively large number of “outlying values”. One approach to remedy this problem is the letter value plot. Install the lvplot package, and try using geom_lv() to display the distribution of price vs cut. What do you learn? How do you interpret the plots?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># need github version, not CRAN</span>
<span class="co"># devtools::install_github(&quot;hadley/lvplot&quot;)</span>
<span class="kw">library</span>(lvplot)

<span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> price)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_lv</span>() <span class="co"># ewwwwwy</span></code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
<p>The idea behind letter value plots was to reduce the over calling of outliers in larger (n &gt; 1000) data sets. and reduce the number of points marked as outliers.</p>
<ol start="5" style="list-style-type: decimal">
<li>Compare and contrast geom_violin() with a facetted geom_histogram(), or a coloured geom_freqpoly(). What are the pros and cons of each method?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(small_diamonds, <span class="kw">aes</span>(cut, carat)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_violin</span>()</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># shows the distribution in a mirrored density curve</span>
<span class="kw">ggplot</span>(small_diamonds, <span class="kw">aes</span>(carat)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_histogram</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span>cut, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-54-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># hard to make distribution comparisons since histogram uses count to determin bar height</span>
<span class="co"># geom_density() is what I prefer</span>
<span class="kw">ggplot</span>(small_diamonds, <span class="kw">aes</span>(carat)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_density</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span>cut)</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-54-3.png" width="672" /></p>
<ol start="6" style="list-style-type: decimal">
<li>If you have a small dataset, it’s sometimes useful to use geom_jitter() to see the relationship between a continuous and categorical variable. The ggbeeswarm package provides a number of methods similar to geom_jitter(). List them and briefly describe what each one does.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggbeeswarm)
<span class="kw">ggplot</span>(small_diamonds, <span class="kw">aes</span>(cut, carat)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_quasirandom</span>()</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-55-1.png" width="672" /></p>
<p>This is similar to geom_violin, in that it attempts show the density via width and similar to jitter in that overalpping points are dodged. The alternate function is <code>geom_beeswarm()</code> which just uses a slightly different positioning algorithim to re-located overlapping points.</p>
</div>
<div id="two-categorical-variables" class="section level3">
<h3>7.5.2 Two categorical variables</h3>
<ol style="list-style-type: decimal">
<li>How could you rescale the count dataset above to more clearly show the distribution of cut within colour, or colour within cut?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">counts &lt;-<span class="st"> </span>diamonds <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>(color, cut)

<span class="kw">library</span>(viridis)</code></pre></div>
<pre><code>## Loading required package: viridisLite</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(counts, <span class="kw">aes</span>(color, <span class="dt">y =</span> cut, <span class="dt">fill =</span> n)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_tile</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_fill_viridis</span>() <span class="co"># use a better color palette is one option for better viz</span></code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/7.5.2.1-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># or add a new proportional summary value</span>

counts2 &lt;-<span class="st"> </span>counts <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(color) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">total =</span> <span class="kw">sum</span>(n),
           <span class="dt">prop =</span> n <span class="op">/</span><span class="st"> </span>total)
    
<span class="kw">ggplot</span>(counts2, <span class="kw">aes</span>(color, cut, <span class="dt">fill =</span> prop)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_tile</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_fill_viridis</span>()</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/7.5.2.1-2.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Use geom_tile() together with dplyr to explore how average flight delays vary by destination and month of year. What makes the plot difficult to read? How could you improve it?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_cancelled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(dest, month) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">avg_delay =</span> <span class="kw">mean</span>(dep_delay)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(month, dest, <span class="dt">fill =</span> avg_delay)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_tile</span>()</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/7.5.2.2-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># there are too many desinations (and blue pallete is bad)</span>

<span class="co"># lets filter to only very common destimations</span>
top_dests &lt;-<span class="st"> </span>not_cancelled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">count</span>(<span class="dt">sort =</span> T) <span class="op">%&gt;%</span><span class="st"> </span>.[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,] <span class="co"># top10</span>

not_cancelled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(dest <span class="op">%in%</span><span class="st"> </span>top_dests<span class="op">$</span>dest) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(dest, month) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">avg_delay =</span> <span class="kw">mean</span>(dep_delay)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(month, dest, <span class="dt">fill =</span> avg_delay)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_tile</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_fill_viridis</span>() <span class="co"># ftw</span></code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/7.5.2.2-2.png" width="672" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Why is it slightly better to use aes(x = color, y = cut) rather than aes(x = cut, y = color) in the example above?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(counts2, <span class="kw">aes</span>(cut, color, <span class="dt">fill =</span> prop)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_tile</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_fill_viridis</span>() <span class="co"># hmmm</span></code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/7.5.2.3-1.png" width="672" /></p>
<p>Crystal Passmore: There are more levels in <code>diamonds$color</code> so it makes more sense to put the <code>factor</code> with more levels on the x-axis.</p>
</div>
<div id="two-continuous-variables" class="section level3">
<h3>7.5.3 Two continuous variables</h3>
<ol style="list-style-type: decimal">
<li>Instead of summarising the conditional distribution with a boxplot, you could use a <code>geom_freqpoly()</code>. What do you need to consider when using the arguments <code>binwidth =</code> and <code>bins =</code>? How does that impact a visualisation of the 2d distribution of carat and price?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># bins() vs bin_width() is a matter of preference</span>
<span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(price, <span class="dt">colour =</span> cut)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">bins =</span> <span class="dv">5000</span>) <span class="co"># dont want to over-fit </span></code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/7.5.3.1-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(price, <span class="dt">colour =</span> cut)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">bins =</span> <span class="dv">5</span>) <span class="co"># or lose trends</span></code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/7.5.3.1-2.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Visualise the distribution of carat, partitioned by price.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diamonds <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">facets =</span> <span class="kw">cut_number</span>(price, <span class="dv">3</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(carat)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_freqpoly</span>(<span class="kw">aes</span>(<span class="dt">color =</span> facets)) <span class="op">+</span>
<span class="st">    </span>ggsci<span class="op">::</span><span class="kw">scale_color_d3</span>(<span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;S&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;L&quot;</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlim</span>(<span class="dv">0</span>,<span class="fl">2.5</span>)</code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<pre><code>## Warning: Removed 126 rows containing non-finite values (stat_bin).</code></pre>
<pre><code>## Warning: Removed 6 rows containing missing values (geom_path).</code></pre>
<p><img src="r4ds_exercises_files/figure-html/7.5.3.2-1.png" width="672" /></p>
<ol start="3" style="list-style-type: decimal">
<li>How does the price distribution of very large diamonds compare to small diamonds. Is it as you expect, or does it surprise you?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># check range</span>
<span class="kw">range</span>(diamonds<span class="op">$</span>carat)</code></pre></div>
<pre><code>## [1] 0.20 5.01</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">quantile</span>(diamonds<span class="op">$</span>carat)</code></pre></div>
<pre><code>##   0%  25%  50%  75% 100% 
## 0.20 0.40 0.70 1.04 5.01</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># use probs arg to cut out small and large diamonds</span>
c1 &lt;-<span class="st"> </span><span class="kw">quantile</span>(diamonds<span class="op">$</span>carat, <span class="dt">probs =</span> .<span class="dv">1</span>) <span class="co"># bottom 10%</span>
c2 &lt;-<span class="st"> </span><span class="kw">quantile</span>(diamonds<span class="op">$</span>carat, .<span class="dv">9</span>) <span class="co"># top 10%</span>

<span class="co"># now for real</span>
diamonds <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">size_cut =</span> Hmisc<span class="op">::</span><span class="kw">cut2</span>( diamonds<span class="op">$</span>carat, <span class="dt">cuts =</span> <span class="kw">c</span>(c1, c2) ) ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(price)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">color =</span> size_cut)) <span class="op">+</span>
<span class="st">    </span>ggsci<span class="op">::</span><span class="kw">scale_color_d3</span>(<span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;bottom10&quot;</span>, <span class="st">&quot;middle80&quot;</span>, <span class="st">&quot;top10&quot;</span>) )</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/7.5.3.3-1.png" width="672" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Combine two of the techniques you’ve learned to visualise the combined distribution of cut, carat, and price.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diamonds <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">facets =</span> <span class="kw">cut_number</span>(price, <span class="dv">3</span>),
                    <span class="dt">size_cut =</span> Hmisc<span class="op">::</span><span class="kw">cut2</span>( diamonds<span class="op">$</span>carat, <span class="dt">cuts =</span> <span class="kw">quantile</span>(diamonds<span class="op">$</span>carat)[<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>] )) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(carat, <span class="dt">color =</span> size_cut)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_freqpoly</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_grid</span>(<span class="op">~</span>facets) <span class="op">+</span>
<span class="st">    </span>ggsci<span class="op">::</span><span class="kw">scale_color_d3</span>(<span class="dt">labels =</span> <span class="kw">paste0</span>(<span class="st">&quot;Q&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlim</span>(<span class="dv">0</span>,<span class="fl">2.5</span>) <span class="co"># ???</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<pre><code>## Warning: Removed 126 rows containing non-finite values (stat_bin).</code></pre>
<pre><code>## Warning: Removed 8 rows containing missing values (geom_path).</code></pre>
<p><img src="r4ds_exercises_files/figure-html/7.5.3.4-1.png" width="672" /></p>
</div>
</div>
<div id="tibbles" class="section level1">
<h1>10 Tibbles</h1>
<div id="section" class="section level3">
<h3>10.5</h3>
<ol style="list-style-type: decimal">
<li>How can you tell if an object is a tibble? (Hint: try printing mtcars, which is a regular data frame).</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(mtcars)</code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars</code></pre></div>
<pre><code>##                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
## Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
## Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
## Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
## Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
## Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
## Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
## Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3
## Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3
## Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4
## Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4
## Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4
## Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
## Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
## Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
## Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
## Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
## AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
## Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4
## Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2
## Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
## Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
## Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
## Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
## Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
## Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
## Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.tibble</span>()</code></pre></div>
<pre><code>## # A tibble: 32 x 11
##      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
##  * &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  21.0     6 160.0   110  3.90 2.620 16.46     0     1     4     4
##  2  21.0     6 160.0   110  3.90 2.875 17.02     0     1     4     4
##  3  22.8     4 108.0    93  3.85 2.320 18.61     1     1     4     1
##  4  21.4     6 258.0   110  3.08 3.215 19.44     1     0     3     1
##  5  18.7     8 360.0   175  3.15 3.440 17.02     0     0     3     2
##  6  18.1     6 225.0   105  2.76 3.460 20.22     1     0     3     1
##  7  14.3     8 360.0   245  3.21 3.570 15.84     0     0     3     4
##  8  24.4     4 146.7    62  3.69 3.190 20.00     1     0     4     2
##  9  22.8     4 140.8    95  3.92 3.150 22.90     1     0     4     2
## 10  19.2     6 167.6   123  3.92 3.440 18.30     1     0     4     4
## # ... with 22 more rows</code></pre>
<p>Or you can print it and if its a tibble it will only print the first 10 rows and look like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&lt;&gt;%</span><span class="st"> </span>as.tibble
mtcars</code></pre></div>
<pre><code>## # A tibble: 32 x 11
##      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
##  * &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  21.0     6 160.0   110  3.90 2.620 16.46     0     1     4     4
##  2  21.0     6 160.0   110  3.90 2.875 17.02     0     1     4     4
##  3  22.8     4 108.0    93  3.85 2.320 18.61     1     1     4     1
##  4  21.4     6 258.0   110  3.08 3.215 19.44     1     0     3     1
##  5  18.7     8 360.0   175  3.15 3.440 17.02     0     0     3     2
##  6  18.1     6 225.0   105  2.76 3.460 20.22     1     0     3     1
##  7  14.3     8 360.0   245  3.21 3.570 15.84     0     0     3     4
##  8  24.4     4 146.7    62  3.69 3.190 20.00     1     0     4     2
##  9  22.8     4 140.8    95  3.92 3.150 22.90     1     0     4     2
## 10  19.2     6 167.6   123  3.92 3.440 18.30     1     0     4     4
## # ... with 22 more rows</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Compare and contrast the following operations on a data.frame and equivalent tibble. What is different? Why might the default data frame behaviours cause you frustration?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">abc =</span> <span class="dv">1</span>, <span class="dt">xyz =</span> <span class="st">&quot;a&quot;</span>)
tib &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">abc =</span> <span class="dv">1</span>, <span class="dt">xyz =</span> <span class="st">&quot;a&quot;</span>)
<span class="co"># using a list for a container</span>
li &lt;-<span class="st"> </span><span class="kw">list</span>(df, tib)
<span class="co"># using map to iterate (ie apply a fxn to each element)</span>
<span class="co"># df$x</span>
<span class="kw">map</span>(li, <span class="op">~</span><span class="st"> </span>.<span class="op">$</span>x)</code></pre></div>
<pre><code>## Warning: Unknown or uninitialised column: &#39;x&#39;.</code></pre>
<pre><code>## [[1]]
## [1] a
## Levels: a
## 
## [[2]]
## NULL</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># tibbles don&#39;t have lazy matching, base R does. You must be specific about colnames with tibbles</span>
<span class="kw">map</span>(li, <span class="op">~</span>.<span class="op">$</span>xyz)</code></pre></div>
<pre><code>## [[1]]
## [1] a
## Levels: a
## 
## [[2]]
## [1] &quot;a&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># also tibbles don&#39;t automatically coherce characters to factors while base R does. You can get around that behavior by setting:</span>
<span class="kw">options</span>(<span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

<span class="co"># df[, &quot;xyz&quot;]</span>
df[, <span class="st">&quot;xyz&quot;</span>]</code></pre></div>
<pre><code>## [1] a
## Levels: a</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tib[, <span class="st">&quot;xyz&quot;</span>]</code></pre></div>
<pre><code>## # A tibble: 1 x 1
##     xyz
##   &lt;chr&gt;
## 1     a</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map</span>(li, <span class="op">~</span>.[,<span class="st">&quot;xyz&quot;</span>])</code></pre></div>
<pre><code>## [[1]]
## [1] a
## Levels: a
## 
## [[2]]
## # A tibble: 1 x 1
##     xyz
##   &lt;chr&gt;
## 1     a</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># A tibble will return the whole row, while a data frame with return only the value in that column &quot;xyz&quot;</span>


<span class="co"># df[, c(&quot;abc&quot;, &quot;xyz&quot;)]</span>
<span class="kw">map</span>(li, <span class="op">~</span>.[, <span class="kw">c</span>(<span class="st">&quot;abc&quot;</span>, <span class="st">&quot;xyz&quot;</span>)])</code></pre></div>
<pre><code>## [[1]]
##   abc xyz
## 1   1   a
## 
## [[2]]
## # A tibble: 1 x 2
##     abc   xyz
##   &lt;dbl&gt; &lt;chr&gt;
## 1     1     a</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># since the data frame is only two columns wide these return the same thing. A data frame only returns columns that are explicitly referenced and a tibble returns the entire observation (row)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>If you have the name of a variable stored in an object, e.g. var &lt;- “mpg”, how can you extract the reference variable from a tibble?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">var &lt;-<span class="st"> &quot;mpg&quot;</span>
mt_tib &lt;-<span class="st"> </span><span class="kw">as.tibble</span>(mtcars)
mt_tib[var] <span class="co"># mt_tib$var fails</span></code></pre></div>
<pre><code>## # A tibble: 32 x 1
##      mpg
##    &lt;dbl&gt;
##  1  21.0
##  2  21.0
##  3  22.8
##  4  21.4
##  5  18.7
##  6  18.1
##  7  14.3
##  8  24.4
##  9  22.8
## 10  19.2
## # ... with 22 more rows</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Practice referring to non-syntactic names in the following data frame by:</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">annoying &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="st">`</span><span class="dt">1</span><span class="st">`</span> =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,
  <span class="st">`</span><span class="dt">2</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">1</span><span class="st">`</span> <span class="op">*</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">length</span>(<span class="st">`</span><span class="dt">1</span><span class="st">`</span>))
)</code></pre></div>
<p>4a. Extracting the variable called 1.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">annoying<span class="op">$</span><span class="st">`</span><span class="dt">1</span><span class="st">`</span> <span class="co"># use backticks</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">annoying[<span class="dv">1</span>] <span class="co"># a happy positional coincidence</span></code></pre></div>
<pre><code>## # A tibble: 10 x 1
##      `1`
##    &lt;int&gt;
##  1     1
##  2     2
##  3     3
##  4     4
##  5     5
##  6     6
##  7     7
##  8     8
##  9     9
## 10    10</code></pre>
<p>4b. Plotting a scatterplot of 1 vs 2.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">annoying <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="st">`</span><span class="dt">1</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2</span><span class="st">`</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/10.5.4b-1.png" width="672" /></p>
<p>4c. Creating a new column called 3 which is 2 divided by 1.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">annoying <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">3</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">2</span><span class="st">`</span> <span class="op">/</span><span class="st"> `</span><span class="dt">1</span><span class="st">`</span>)
annoying</code></pre></div>
<pre><code>## # A tibble: 10 x 3
##      `1`       `2`      `3`
##    &lt;int&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1     1  3.751278 3.751278
##  2     2  5.228234 2.614117
##  3     3  7.224010 2.408003
##  4     4  5.993219 1.498305
##  5     5 12.284038 2.456808
##  6     6 12.628630 2.104772
##  7     7 13.456741 1.922392
##  8     8 15.322801 1.915350
##  9     9 18.145079 2.016120
## 10    10 20.368497 2.036850</code></pre>
<p>4d. Renaming the columns to one, two and three.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">annoying <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">one =</span> <span class="st">`</span><span class="dt">1</span><span class="st">`</span>,
                    <span class="dt">two =</span> <span class="st">`</span><span class="dt">2</span><span class="st">`</span>,
                    <span class="dt">three =</span> <span class="st">`</span><span class="dt">3</span><span class="st">`</span>)</code></pre></div>
<pre><code>## # A tibble: 10 x 3
##      one       two    three
##    &lt;int&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1     1  3.751278 3.751278
##  2     2  5.228234 2.614117
##  3     3  7.224010 2.408003
##  4     4  5.993219 1.498305
##  5     5 12.284038 2.456808
##  6     6 12.628630 2.104772
##  7     7 13.456741 1.922392
##  8     8 15.322801 1.915350
##  9     9 18.145079 2.016120
## 10    10 20.368497 2.036850</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># or</span>
annoying <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">one =</span> <span class="st">&quot;1&quot;</span>,
                    <span class="dt">two =</span> <span class="st">&quot;2&quot;</span>,
                    <span class="dt">three =</span> <span class="st">&quot;3&quot;</span>)</code></pre></div>
<pre><code>## # A tibble: 10 x 3
##      one       two    three
##    &lt;int&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1     1  3.751278 3.751278
##  2     2  5.228234 2.614117
##  3     3  7.224010 2.408003
##  4     4  5.993219 1.498305
##  5     5 12.284038 2.456808
##  6     6 12.628630 2.104772
##  7     7 13.456741 1.922392
##  8     8 15.322801 1.915350
##  9     9 18.145079 2.016120
## 10    10 20.368497 2.036850</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>What does tibble::enframe() do? When might you use it?</li>
</ol>
<p>From <code>?tibble::enframe</code>: <code>enframe()</code> converts named atomic vectors or lists to two-column data frames. For unnamed vectors, the natural sequence is used as name column.</p>
<p>This might be useful if you have a named vector you can to build into a tibble. Lots of functions will return results in a list or names vector format when there are several values to be outputted.</p>
<ol start="6" style="list-style-type: decimal">
<li>What option controls how many additional column names are printed at the footer of a tibble?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ???</span></code></pre></div>
</div>
</div>
<div id="advanced-ggplot2" class="section level1">
<h1>28 Advanced <code>ggplot2</code></h1>
<div id="label" class="section level3">
<h3>28.2 Label</h3>
<ol style="list-style-type: decimal">
<li>Create one plot on the fuel economy data with customised title, subtitle, caption, x, y, and colour labels.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> class)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;My title&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;My sub-title&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Engine displacement (L)&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Highway fuel economy (mpg)&quot;</span>,
       <span class="dt">caption =</span> <span class="st">&quot;My caption&quot;</span>,
       <span class="dt">colour =</span> <span class="st">&quot;Car type&quot;</span>
)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="r4ds_exercises_files/figure-html/28.2.1-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>The geom_smooth() is somewhat misleading because the hwy for large engines is skewed upwards due to the inclusion of lightweight sports cars with big engines. Use your modelling tools to fit and display a better model.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mpg_wo_2seaters &lt;-<span class="st"> </span><span class="kw">filter</span>(mpg, class <span class="op">!=</span><span class="st"> &quot;2seater&quot;</span>)

<span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> class)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">data =</span> <span class="kw">filter</span>(mpg, class <span class="op">!=</span><span class="st"> &quot;2seater&quot;</span>), <span class="dt">se =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># just adjust the data going into the geom_smooth() layer</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Take an exploratory graphic that you’ve created in the last month, and add informative titles to make it easier for others to understand.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;ChickWeight&quot;</span>)
<span class="kw">ggplot</span>(ChickWeight, <span class="kw">aes</span>(Time, weight, <span class="dt">color =</span> Diet)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> F) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;The Effect of Diet on Weight Gain&quot;</span>,
         <span class="dt">y =</span> <span class="st">&quot;Weight (grams)&quot;</span>,
         <span class="dt">x =</span> <span class="st">&quot;Time (days)&quot;</span>)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
</div>
<div id="annotations" class="section level3">
<h3>28.3 Annotations</h3>
<ol style="list-style-type: decimal">
<li>Use geom_text() with infinite positions to place text at the four corners of the plot.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">corners &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),
                  <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))
<span class="kw">ggplot</span>(corners, <span class="kw">aes</span>(x,y)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_text</span>(<span class="dt">label =</span> <span class="st">&quot;bot_right&quot;</span>, <span class="dt">x =</span> <span class="ot">Inf</span>, <span class="dt">y =</span> <span class="op">-</span><span class="ot">Inf</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_text</span>(<span class="dt">label =</span> <span class="st">&quot;top_right&quot;</span>, <span class="dt">x =</span> <span class="ot">Inf</span>, <span class="dt">y =</span> <span class="ot">Inf</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_text</span>(<span class="dt">label =</span> <span class="st">&quot;bot_left&quot;</span>, <span class="dt">x =</span> <span class="op">-</span><span class="ot">Inf</span>, <span class="dt">y =</span> <span class="op">-</span><span class="ot">Inf</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_text</span>(<span class="dt">label =</span> <span class="st">&quot;top_left&quot;</span>, <span class="dt">x =</span> <span class="op">-</span><span class="ot">Inf</span>, <span class="dt">y =</span> <span class="ot">Inf</span>)</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/28.3.1-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Read the documentation for annotate(). How can you use it to add a text label to a plot without having to create a tibble?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?annotate
<span class="kw">ggplot</span>(corners, <span class="kw">aes</span>(x,y)) <span class="op">+</span>
<span class="st">    </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> .<span class="dv">5</span>, <span class="dt">y =</span> .<span class="dv">5</span>, <span class="dt">label =</span> <span class="st">&quot;Middle&quot;</span>)</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
<ol start="3" style="list-style-type: decimal">
<li>How do labels with geom_text() interact with faceting? How can you add a label to a single facet? How can you put a different label in each facet? (Hint: think about the underlying data.)</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mpg <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(cyl) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">avg_cty =</span> <span class="kw">round</span>(<span class="kw">mean</span>(cty),<span class="dv">1</span>))
<span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="kw">aes</span>(cty, hwy)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> avg_cty), <span class="dt">y =</span> <span class="dv">40</span>, <span class="dt">x =</span> <span class="dv">15</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_grid</span>(<span class="op">~</span>cyl)</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-59-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># delete unwanted labels for facets</span>
mpg<span class="op">$</span>avg_cty <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw">ifelse</span>(mpg<span class="op">$</span>cyl <span class="op">==</span><span class="st"> </span><span class="dv">6</span>, ., <span class="ot">NA</span>)
<span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="kw">aes</span>(cty, hwy)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> avg_cty), <span class="dt">y =</span> <span class="dv">40</span>, <span class="dt">x =</span> <span class="dv">15</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_grid</span>(<span class="op">~</span>cyl)</code></pre></div>
<pre><code>## Warning: Removed 155 rows containing missing values (geom_text).</code></pre>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-59-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># really the best thing to do is use a seperate tibble</span>
<span class="kw">data</span>(mpg)
avgs &lt;-<span class="st"> </span>mpg <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(cyl) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">avg_cty =</span> <span class="kw">round</span>(<span class="kw">mean</span>(cty), <span class="dv">1</span>))
<span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="kw">aes</span>(cty, hwy)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_text</span>(<span class="dt">data =</span> avgs, <span class="kw">aes</span>(<span class="dt">label =</span> avg_cty), <span class="dt">y =</span> <span class="dv">40</span>, <span class="dt">x =</span> <span class="dv">15</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_grid</span>(<span class="op">~</span>cyl)</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-59-3.png" width="672" /></p>
<ol start="4" style="list-style-type: decimal">
<li>What arguments to geom_label() control the appearance of the background box?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="kw">aes</span>(cty, hwy)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_label</span>(<span class="dt">data =</span> avgs, <span class="kw">aes</span>(<span class="dt">label =</span> avg_cty, <span class="dt">fill =</span> <span class="kw">as.factor</span>(cyl)), <span class="dt">y =</span> <span class="dv">30</span>, <span class="dt">x =</span> <span class="dv">15</span>, <span class="dt">alpha =</span> .<span class="dv">5</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_grid</span>(<span class="op">~</span>cyl)</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<ol start="5" style="list-style-type: decimal">
<li>What are the four arguments to arrow()? How do they work? Create a series of plots that demonstrate the most important options.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrow</span>()</code></pre></div>
<pre><code>## $angle
## [1] 30
## 
## $length
## [1] 0.25inches
## 
## $ends
## [1] 2
## 
## $type
## [1] 1
## 
## attr(,&quot;class&quot;)
## [1] &quot;arrow&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># need to complete :(</span></code></pre></div>
</div>
<div id="scales" class="section level3">
<h3>28.4 Scales</h3>
<ol style="list-style-type: decimal">
<li>Why doesn’t the following code override the default scale? Because <code>?geom_hex()</code> tells us that it is counting the number of cases in each hexagon and mapping that value to the <code>fill</code> aesthetic. So changing the <code>color</code> scale has no appreciable effect.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># the data from earlier</span>
<span class="kw">set.seed</span>(<span class="dv">1</span>)
df &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">x =</span> <span class="kw">rnorm</span>(<span class="dv">10000</span>),
  <span class="dt">y =</span> <span class="kw">rnorm</span>(<span class="dv">10000</span>)
)

<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(x, y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hex</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># now it works</span>
<span class="st">  </span><span class="kw">coord_fixed</span>()</code></pre></div>
<pre><code>## Warning: Computation failed in `stat_binhex()`:
## Package `hexbin` required for `stat_binhex`.
## Please install and try again.</code></pre>
<p><img src="r4ds_exercises_files/figure-html/28.4.1-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li><p>What is the first argument to every scale? How does it compare to labs()? <code>aesthetics</code>, which is defining the names of the aesthetics a scale works with. This is similar to <code>labs()</code> that takes a name-value pairs first and can also be used to label legends/aesthetics.</p></li>
<li>Change the display of the presidential terms by:</li>
<li><p>Combining the two variants shown above</p></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">presidential <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="dv">33</span> <span class="op">+</span><span class="st"> </span><span class="kw">row_number</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(start, id, <span class="dt">colour =</span> party)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">xend =</span> end, <span class="dt">yend =</span> id)) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_colour_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dt">Republican =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">Democratic =</span> <span class="st">&quot;blue&quot;</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_x_date</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> presidential<span class="op">$</span>start, <span class="dt">date_labels =</span> <span class="st">&quot;&#39;%y&quot;</span>)</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-62-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Improving the display of the y-axis.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">presidential <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="dv">33</span> <span class="op">+</span><span class="st"> </span><span class="kw">row_number</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(start, id, <span class="dt">colour =</span> party)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">xend =</span> end, <span class="dt">yend =</span> id)) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_colour_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dt">Republican =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">Democratic =</span> <span class="st">&quot;blue&quot;</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_x_date</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> presidential<span class="op">$</span>start, <span class="dt">date_labels =</span> <span class="st">&quot;&#39;%y&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="dv">34</span><span class="op">:</span><span class="dv">44</span>)</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-63-1.png" width="672" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Labelling each term with the name of the president.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">presidential <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="dv">33</span> <span class="op">+</span><span class="st"> </span><span class="kw">row_number</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(start, id, <span class="dt">colour =</span> party)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">xend =</span> end, <span class="dt">yend =</span> id)) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_colour_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dt">Republican =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">Democratic =</span> <span class="st">&quot;blue&quot;</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_x_date</span>(<span class="dt">breaks =</span> presidential<span class="op">$</span>start, <span class="dt">date_labels =</span> <span class="st">&quot;&#39;%y&quot;</span>, <span class="dt">date_breaks =</span> <span class="st">&quot;4 years&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="dv">34</span><span class="op">:</span><span class="dv">44</span>, <span class="dt">labels =</span> presidential<span class="op">$</span>name) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Is it there?&quot;</span>)</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-64-1.png" width="672" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Adding informative plot labels.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># code by Crystal Passmore</span>
presidential <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="dv">33</span> <span class="op">+</span><span class="st"> </span><span class="kw">row_number</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(start, id, <span class="dt">colour =</span> party)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">xend =</span> end, <span class="dt">yend =</span> id)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_colour_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dt">Republican =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">Democratic =</span> <span class="st">&quot;blue&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">34</span>, <span class="dv">44</span>, <span class="dt">by =</span> <span class="dv">1</span>), <span class="dt">labels =</span> presidential<span class="op">$</span>name) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;President&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Presidentail Terms&quot;</span>)</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Placing breaks every 4 years (this is trickier than it seems!).</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">presidential <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="dv">33</span> <span class="op">+</span><span class="st"> </span><span class="kw">row_number</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(start, id, <span class="dt">colour =</span> party)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">xend =</span> end, <span class="dt">yend =</span> id)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_colour_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dt">Republican =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">Democratic =</span> <span class="st">&quot;blue&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">34</span>, <span class="dv">44</span>, <span class="dt">by =</span> <span class="dv">1</span>), <span class="dt">labels =</span> presidential<span class="op">$</span>name) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;President&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Presidentail Terms&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">date_breaks =</span> <span class="st">&quot;4 years&quot;</span>, <span class="dt">date_labels =</span> <span class="st">&quot;%y&quot;</span>)</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-66-1.png" width="672" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Use override.aes to make the legend on the following plot easier to see.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(carat, price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> cut), <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">20</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">guides</span>(<span class="dt">color =</span> <span class="kw">guide_legend</span>(<span class="dt">title =</span> <span class="st">&quot;Because&quot;</span>,<span class="dt">override.aes =</span> <span class="kw">list</span>(<span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">shape =</span> <span class="dv">24</span>, <span class="dt">size =</span> <span class="dv">4</span>)))</code></pre></div>
<p><img src="r4ds_exercises_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
</div>
</div>

<hr>
<p>
    Built with <a href = "http://rmarkdown.rstudio.com/rmarkdown_websites.html">Rmd</a>.
    Hosted on <a href = "https://pages.github.com/">Github</a>.
        Maintained by <a href = "mailto:nathancday@gmail.com">me</a>.
        Copyright &copy; 2017.
</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
